---
- name: Create the `aur_builder` user
  become: true
  ansible.builtin.user:
    name: aur_builder
    create_home: yes
    group: wheel

- name: Allow the `aur_builder` user to run `sudo pacman` without a password
  become: true
  ansible.builtin.lineinfile:
    path: /etc/sudoers.d/11-install-aur_builder
    line: 'aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman'
    create: yes
    mode: 0644
    validate: 'visudo -cf %s'

- name: Install tools
  become: true
  pacman:
    name:
      - flatpak # System Agnostic Package Management
      - filelight # Disk Usage Display
      - libreoffice # Office Suite
      - mpv # Lightweight Media Player
      - qbittorrent # Torrent Client

- name: Install Flatpak programs
  community.general.flatpak:
    name:
      - com.github.tchx84.Flatseal #Flatpak Permissions GUI Manager
      # - com.github.d4nj1.tlpui
      - com.bitwarden.desktop
      - io.podman_desktop.PodmanDesktop
      - md.obsidian.Obsidian
      - org.remmina.Remmina

- name: Install archiving tools
  become: true
  pacman:
    name:
      - ark # Archive Manager
      - zip
      - unrar
      - unzip

- name: Install browsers
  become: true
  pacman:
    name:
      - chromium
      - qutebrowser

- name: Install browsers (AUR)
  become: true
  become_user: aur_builder
  kewlfft.aur.aur:
    name:
      - brave-bin

- name: Install AUR packages
  become: true
  become_user: aur_builder
  kewlfft.aur.aur:
    name:
      - appimagelauncher
      - slimbookbattery
      # - slimbookintelcontroller
      - webapp-manager
      - ueberzugpp

- name: Install terminals and terminal software
  become: true
  pacman:
    name:
      - alacritty
      - bash-completion
      - btop
      - git
      - lshw
      - polkit-gnome
      - tmux

- name: Install NeoVim
  become: true
  pacman:
    name: neovim

- name: Install backup software
  become: true
  pacman:
    name: timeshift

- name: Install build software
  become: true
  pacman:
    name:
      - cmake
      - meson

- name: Install file managers and dependencies
  become: true
  become_user: aur_builder
  kewlfft.aur.aur:
    name:
      - gvfs
      - gvfs-smb
      - gvfs-mtp
      - gvfs-gphoto2
      - ranger
      - thunar
      - thunar-archive-plugin
      - thunar-media-tags-plugin
      - thunar-vcs-plugin
      - thunar-volman
      - ueberzugpp # for image viewing in ranger

- name: ensure power-profiles-daemon is removed
  become: true
  pacman:
    name: power-profiles-daemon
    state: absent

- name: Install power and thermal management
  become: true
  pacman:
    name:
      - tlp
      - thermald 
      - xfce4-power-manager

- name: Install printing system
  pacman:
    name:
      - cups
      - system-config-printer
  become: true

- name: Install programming langauages, packages, and frameworks
  become: true
  pacman:
    name:
      - go
      - gcc
      - nodejs
      - python-pip
      - python-poetry
      - rustup

- name: Install audio and audio control
  become: true
  pacman:
    name: 
      - pipewire
      - pipewire-alsa
      - pipewire-pulse
      - pavucontrol
      - wireplumber

- name: Install Virtualization
  become: true
  pacman:
    name:
      - dnsmasq
      - iptables-nft
      - libvirt
      - qemu-desktop
      - swtpm
      - virt-manager

- name: Install misc packages
  become: true
  pacman:
    name:
      - docker
      - imagemagick

- name: Install xdg-desktop-portal(s)
  become: true
  pacman:
    name:
      - xdg-desktop-portal
      - xdg-desktop-portal-gtk

- name: Ensure xdg-desktop-portal-gnome is absent
  become: true
  pacman:
    name: xdg-desktop-portal-gnome
    state: absent

